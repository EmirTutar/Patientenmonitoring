networks:
  mqtt5_network:
    name: mqtt5_network

services:
  yolov5:
    build:
      context: ./yolov5/detection
      dockerfile: Dockerfile
    env_file: ./yolov5/.yolov5.env
    devices:
      - /dev/video0:/dev/video0  # Acces to camera

  mqtt_video:
    build:
      context: ./yolov5/video
      dockerfile: Dockerfile
    env_file: ./yolov5/.yolov5.env
    environment:
      - DISPLAY=$DISPLAY
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ~/.Xauthority:/root/.Xauthority
    network_mode: "host"
    
  # mqtt5 eclipse-mosquitto
  mqtt5:
    build:
      context: ./mqtt5
      dockerfile: Dockerfile
    container_name: mqtt5
    ports:
      - "1883:1883" #default mqtt port
      - "9001:9001" #default mqtt port for websockets
    networks:
      - mqtt5_network
    volumes: 
      - ./mqtt5/data:/mosquitto/data
      - ./mqtt5/log:/mosquitto/log
    restart: unless-stopped

  mqtt5-publisher:
    build:
      context: ./mqtt5/example
      dockerfile: Dockerfile
    env_file:
      - path: ./mqtt5/example/.env
        required: true # default
      - path: ./mqtt5/example/.env.override
        required: false
    container_name: mqtt5_publisher
    networks:
      - mqtt5_network
    command: ["python3", "-u", "publisher.py"]
    restart: unless-stopped
  
  mqtt5-subscriber:
    build:
      context: ./mqtt5/example
      dockerfile: Dockerfile
    env_file:
      - path: ./mqtt5/example/.env
        required: true # default
      - path: ./mqtt5/example/.env.override
        required: false
    container_name: mqtt5_subscriber
    networks:
      - mqtt5_network
    command: ["python3", "-u", "subscriber.py"]
    restart: unless-stopped



